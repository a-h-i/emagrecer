language: 'typescript'
type: application

fileGroups:
  configs:
    - 'package.json'
    - 'tsconfig.json'
    - 'tailwing.config.ts'
    - 'postcss.config.mjs'
    - 'eslint.config.mjs'
    - 'next.config.ts'
  sources:
    - 'app/**/*'
    - 'i18n/**/*'
    - 'lib/**/*'
    - 'messages/**/*'
    - 'public/**/*'
    - 'middleware.ts'
    - 'auth.ts'
    - 'env-config.ts'
tasks:
  dev:
    command: docker compose up --remove-orphans server
    local: true
    deps:
      - 'control:build'
      - 'migrator:build'
  build:
    command: pnpm run build
    inputs:
      - '@files(configs)'
      - '@files(sources)'
    outputs:
      - '.next'
    deps:
      - 'control:build'
  prod:
    command: pnpm run start
    deps:
      - 'build'
    local: true
  lint:
    command: pnpm run lint
    deps:
      - 'build'
    inputs:
      - '@files(configs)'
      - '@files(sources)'
  format:
    command: pnpm run format
    inputs:
      - '@files(configs)'
      - '@files(sources)'
    options:
      runInCI: false
  checkFormat:
    command: pnpm run format:check
    inputs:
      - '@files(configs)'
      - '@files(sources)'
